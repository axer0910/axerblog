---
title: 有关flex属性的flex-shrink和flex-grow
tag: frontend
date: 2019-01-13
updated: 2019-01-13
---

### 有关flex属性的flex-shrink和flex-grow

最近在做UI需求的时候，设计师给了一个纵向三栏的布局，最后一个栏目撑满页面剩余空间。在实现的时候第一个想法是父容器给予一个高度，flex属性使用`align-items: stretch`，最后一个元素高度设置为100%撑满解决。
![Alt text](./1560742229915.png)
在实际实现过程中有一个问题，就是**边栏1+边栏2+边栏3**随着内容量变化是会超过100vh的，需要加上滚动。这个时候设置父容器固定100vh高度（`height: 100vh`），再加上overflow: hidden也可以实现滚动。但是项目里要求使用一个滚动组件，需要滚动的内容一定要有完整的滚动高度，没有办法固定死高度为100vh，所以内部content的高度需要改写成`min-height: 100vh`。这个时候align-items: stretch就不起作用了，最后一个设置了height: 100%不会自动撑满剩余空间。

#### 使用flex-grow
`flex-grow`在MDN定义是弹性盒子项（flex item）的拉伸因子。比较抽象。用实例来解释下：
如果flex容器盒子高度500px，有三个子元素分别高100px，150px，100px，那么剩余空间150px
如果给三个元素分别定义flex-grow的值为1，2，3，他们加起来一共是6。
那么三个元素可以分配到的空间就是**剩余空间x（flex-shrink系数）/(flex-shrink总和)**：
* box1: 150 * 1 / 6 = 25px
* box1: 150 * 2 / 6 = 50px
* box1: 150 * 3 / 6 = 75px
三个元素最终的高度分别为 125px，200px，175px。
* 100px + 25px = 125px
* 150px + 50px = 200px
* 100px + 75px = 175px

这样每个元素就能按比例分配剩余空间了。回到上面需求，最后一个元素设置flex-grow为1就行了（所有剩余的空间都分配给他）。
有一点需要注意，当所有元素的 flex-grow 之和小于 1 的时候（注意是 1，也就是说每个元素的 flex-grow 都是一个小数如 0.2 这样的），上面式子中的 sum 将会使用 1 来参与计算，而不论它们的和是多少。也就是说，当所有的元素的 flex-grow 之和小于 1 的时候，剩余空间不会全部分配给各个元素。

####有关flex-shrink
flex-shrink和flex-grow是相反的，即位元素的收缩因子。如果子元素高度加超过父容器高度，那么就会按照flex-shrink的设置收缩每一个元素使得父容器能容纳所有子元素。
如果父元素 500px。三个子元素分别设置为 150px，200px，300px。
三个子元素的 flex-shrink 的值分别为 1，2，3。
那么溢出的大小：150 + 200 + 300 - 500 = -150px。
-150px会按照flex-shrink的配置平均分配给每个元素上去。
计算方式：每个元素收缩的权重为其 flex-shrink 乘以其宽度。
先计算总权重：1 * 150 + 2 * 200 + 3 * 300 = 1450
每个元素收缩的量：
* box1：150 * 1(flex-shrink) * 150(width) / 1450 = -15.5
* box2：150 * 2(flex-shrink) * 200(width) / 1450 = -41.4
* box3：150 * 3(flex-shrink) * 300(width) / 1450 = -93.1
三个元素的最终宽度分别为：
* 150 - 15.5 = 134.5
* 200 - 41.4 = 158.6
* 300 - 93.1 = 206.9

如果flex-shrink小于1，那么不会收缩所有空间，如果上面flex-shrink改成0.1,  0.2, 0.3，那么实际上只会收缩150px 的 (0.1 + 0.2 + 0.3) / 1 即 60% 的空间。
每个元素收缩的空间为：
* 90 * 0.1(flex-shrink) * 150(width) / 145 = 9.31
* 90 * 0.2(flex-shrink) * 200(width) / 145 = 24.83
* 90 * 0.3(flex-shrink) * 300(width) / 145 = 55.86

如果某个元素不需要收缩，那么设置`flex-shrink: 0`即可（收缩0%的空间）
